angular.module("app").controller("autenticacaoCtrl",["$scope","helper",function(a,b){a.view={email:"Entre com seu email",senha:"Entre com sua senha"},a.dados={email:"",senha:""},a.logar=function(){b.post("User/Logar",a.dados,function(){b.redirecionar("home")})},a.keyLogar=function(b){13!==b.which&&13!==b.keyCode||a.logar()}}]),angular.module("app").controller("categoriaCtrl",["$scope","helper",function(a,b){function c(c){b.post("Categoria/Cadastrar",a.dados,c)}function d(c){b.post("Categoria/Editar",a.dados,c)}a.view={editar:!1},a.dados={id:null,descricao:null,ativo:null},a.backup={id:null,descricao:null,ativo:null},a.lovSituacao=[{id:"2",descricao:"Inativo"},{id:"1",descricao:"Ativo"}],a.grade={lista:[]},b.get("Categoria/Listar",a.dados.id,function(b){a.grade.lista=b}),a.onClickSalvar=function(){a.dados.id>0?d(function(c){a.grade.lista=c.Entidade,b.mensagem(c.Mensagem),a.view.editar=!1,a.view.editar=!1,a.dados={}}):c(function(c){a.grade.lista=c.Entidade,b.mensagem(c.Mensagem),a.dados={}})},a.onClickEditarItem=function(b){a.backup=angular.copy(b),a.dados=b,a.view.editar=!0},a.onClickDesfazerSalvar=function(){a.view.editar=!1;var b=a.grade.lista.indexOf(a.dados);a.grade.lista[b]=angular.copy(a.backup),a.backup={},a.dados={}}}]),angular.module("app").controller("clienteListarCtrl",["$scope","helper",function(a,b){function c(){b.post("Cliente/Listar",a.view.filtroUnico,function(b){a.view.dados.clearGrid(),a.view.dados=a.toList(b)})}a.view={filtroUnico:"",placeholder:"Pesquisar por: Código - Razão Social/Nome Fantasia - Situação",dados:[]},a.promessa(function(){a.UserNivel().In(1)||c()}),a.onKeyPressListar=function(a){13!==a.which&&13!==a.keyCode||c()},a.onClickListar=function(){c()}}]),angular.module("app").controller("clienteCtrl",["$scope","helper","servico","$routeParams","userService","upload",function(a,b,c,d,e,f){function g(){var c={id:a.dados.id,tabela:"cliente"};b.post("User/BuscarUsuarioDaTabela",c,function(b){a.dadosLov.usuario=b.Entidade})}function h(c){b.post("Cliente/Cadastrar",a.dados,c)}function i(){b.post("Cliente/Editar",a.dados,function(a){b.mensagem(a)})}a.view={aba:1,title:a.pagina.titulo,legenda:a.pagina.legenda,page:"Cliente",fotoDefault:b.loadImage("cliente.png")},a.dados={id:null},a.dados.id=d.id>0?d.id:0,b.get("Cliente/Buscar",a.dados.id,function(b){a.dados=b.Entidade,a.dadosLov=b.Lov,a.onChangeCarregaCidades(a.dados.uf_id)}),a.onChangeCarregaCidades=function(b){b>0&&c.getMunicipios(b,function(b){a.dadosLov.cidade=b,a.dadosLov.cidade_id=a.dados.cidade_id})},a.onClickSalvar=function(){a.dados.id>0?i():h(function(c){a.dados.id=c.Entidade.id,b.mensagem(c.Mensagem);var d={tabela_id:a.dados.id,tabela_nome:"cliente",usuario_id:0,nivel:2,funcao:g};e.abrirModal(d)})},a.onClickEditarUsuario=function(b){var c={tabela_id:a.dados.id,tabela_nome:"cliente",usuario_id:b.id,nome:b.nome,nivel:2,email:b.email,funcao:g};e.abrirModal(c)},a.onClickCadastrarUsuario=function(){var b={tabela_id:a.dados.id,tabela_nome:"cliente",usuario_id:0,nivel:2,funcao:g};e.abrirModal(b)},a.onClickCarregarFoto=function(a){var b={server:"User/AtualizarFoto",limiteArquivos:1,formData:a,autoClose:!0};f.open(b,function(){g()})}}]),angular.module("app").controller("configuracaoCtrl",["$scope","helper","upload",function(a,b,c){function d(c){b.post("Configuracao/Cadastrar",a.dados,c)}function e(c){b.post("Configuracao/Editar",a.dados,c)}a.view={aba:1},a.dados={id:null,empresa:null,smtp_host:null,smtp_user:null,smtp_pass:null,smtp_port:null,smtp_timeout:null,myhost:null},b.post("Configuracao/Buscar",null,function(b){a.dados=b.Entidade,a.image=b.Lov[0],a.view.aba=a.UserNivel().In(1)?1:4}),a.onClickSalvar=function(){a.dados.id>0?e(function(a){b.mensagem(a)}):d(function(a){b.mensagem(a)})},a.onUpload=function(){var b={server:"Configuracao/Upload",limiteArquivos:1,formData:a.UserCodigo()};c.open(b,function(b){a.image=b})}}]),angular.module("app").controller("editarImagemCtrl",["$scope","helper","$modalInstance","param",function(a,b,c,d){a.view={titulo:"Editar Texto"},a.dados=d.dados,a.onClickFecharModal=function(){c.dismiss("cancel")},a.onClickSalvar=function(){d.scope.images=[],b.post("Orcamento/EditarTextoImagem",a.dados,function(a){d.scope.images=a,c.dismiss("cancel")})}}]),angular.module("app").controller("estabelecimentoListarCtrl",["$scope","helper",function(a,b){function c(){b.post("Estabelecimento/Listar",a.view.filtroUnico,function(b){a.view.dados.clearGrid(),a.view.dados=a.toList(b)})}a.view={filtroUnico:"",placeholder:"Pesquisar por: Código - CPF/CNPJ-Razão Social/Nome Fantasia - Categoria - Situação",dados:[]},a.promessa(function(){a.UserNivel().In(1)||c()}),a.onKeyPressListar=function(a){13!==a.which&&13!==a.keyCode||c()},a.onClickListar=function(){c()}}]),angular.module("app").controller("estabelecimentoCtrl",["$scope","helper","servico","$routeParams","userService","upload",function(a,b,c,d,e,f){function g(){var c={id:a.dados.id,tabela:"estabelecimento"};b.post("User/BuscarUsuarioDaTabela",c,function(b){a.dadosLov.usuario=b.Entidade})}function h(c){b.post("Estabelecimento/Cadastrar",a.dados,c)}function i(){b.post("Estabelecimento/Editar",a.dados,function(a){b.mensagem(a)})}a.view={aba:1,title:a.pagina.titulo,legenda:a.pagina.legenda,page:"Estabelecimento",fotoDefault:b.loadImage("cliente.png")},a.dados={id:null},a.dados.id=d.id>0?d.id:0,b.get("Estabelecimento/Buscar",a.dados.id,function(b){a.dados=b.Entidade,a.dadosLov=b.Lov,a.onChangeCarregaCidades(a.dados.uf_id)}),a.onChangeCarregaCidades=function(b){b>0&&c.getMunicipios(b,function(b){a.dadosLov.cidade=b,a.dadosLov.cidade_id=a.dados.cidade_id})},a.onClickSalvar=function(){a.dados.id>0?i():h(function(c){a.dados.id=c.Entidade.id,b.mensagem(c.Mensagem);var d={tabela_id:a.dados.id,tabela_nome:"estabelecimento",usuario_id:0,nivel:3,funcao:g};e.abrirModal(d)})},a.onClickCarregarFoto=function(a){var b={server:"User/AtualizarFoto",limiteArquivos:1,formData:a,autoClose:!0};f.open(b,function(){g()})},a.onClickEditarUsuario=function(b){var c={tabela_id:a.dados.id,tabela_nome:"estabelecimento",usuario_id:b.id,nome:b.nome,email:b.email,nivel:3,funcao:g};e.abrirModal(c)},a.onClickCadastrarUsuario=function(){var b={tabela_id:a.dados.id,tabela_nome:"estabelecimento",usuario_id:0,nivel:3,funcao:g};e.abrirModal(b)}}]),angular.module("app").controller("grupoCtrl",["$scope","helper",function(a,b){function c(c){b.post("Grupo/Cadastrar",a.dados,c)}function d(c){b.post("Grupo/Editar",a.dados,c)}a.view={editar:!1},a.dados={id:null,descricao:null,categoria_id:null},a.backup={id:null,descricao:null,categoria_id:null},a.lov=[],a.grade={lista:[]},b.get("Grupo/Listar",a.dados.id,function(b){a.grade.lista=b.Entidade,a.lov=b.Lov}),a.onClickSalvar=function(){a.dados.id>0?d(function(c){a.grade.lista=c.Entidade,b.mensagem(c.Mensagem),a.view.editar=!1,a.view.editar=!1,a.dados={}}):c(function(c){a.grade.lista=c.Entidade,b.mensagem(c.Mensagem),a.dados={}})},a.onClickEditarItem=function(b){a.backup.id=angular.copy(b.id),a.backup.descricao=angular.copy(b.id),a.backup.categoria_id=angular.copy(b.id),a.dados.id=b.id,a.dados.descricao=b.descricao,a.dados.categoria_id=b.categoria_id,a.view.editar=!0},a.onClickDesfazerSalvar=function(){a.view.editar=!1;var b=a.grade.lista.indexOf(a.dados);a.grade.lista[b]=angular.copy(a.backup),a.backup={},a.dados={}}}]),angular.module("app").controller("homeCtrl",["$scope","helper","$timeout",function(a,b,c){function d(){"Home"===a.pagina.titulo&&(b.get("Home/Listar",null,function(b){a.view.lista=b}),c(d,3e4))}a.view={lista:[]},d(),a.chat.init()}]),angular.module("app").controller("imagemCtrl",["$scope","helper","$routeParams",function(a,b,c){function d(){a.images=[],b.post("Orcamento/BuscarImagem",{id:a.view.id},function(b){a.images=b,a.view.isImagem=b.length>0?"":"Não existe imagem cadastrada."})}a.view={isImagem:!1,id:c.id},d()}]),angular.module("app").controller("licencaCtrl",["$scope","helper",function(a,b){b.get("User/Chave",null,function(b){a.ChaveGerada=b})}]),angular.module("app").controller("masterCtrl",["$scope","helper","upload",function(a,b,c){function d(){b.get("Master/Listar",a.dados.id,function(b){a.grade.lista=b})}function e(){a.view.alterarSenha=!1,a.view.senhaOK=!1,a.view.senha2="",a.view.senhaCheck=""}function f(c){b.post("Master/Cadastrar",a.dados,c)}function g(c){b.post("Master/Editar",a.dados,c)}function h(){return a.view.alterarSenha?String().isNullOrEmpty(a.dados.senha)?(b.msgAdvertencia("Digita sua senha."),!1):a.dados.senha!==a.view.senha2?(b.msgAdvertencia("Senhas não conferem"),!1):!0:!0}a.view={senha2:"",senhaCheck:"",alterarSenha:!1,senhaOK:!1,fotoDefault:b.loadImage("cliente.png")},a.clear=function(){return{id:null,nome:null,email:null,senha:null}},a.dados=a.clear(),a.itemBackup=a.clear(),a.grade={lista:[]},d(),a.onClickCarregarFoto=function(a){var b={server:"User/AtualizarFoto",limiteArquivos:1,formData:a,autoClose:!0};c.open(b,function(){d()})},a.onClickSalvar=function(){h()&&(a.dados.id>0?g(function(c){a.grade.lista=c.Entidade,b.mensagem(c.Mensagem)}):f(function(c){a.grade.lista=c.Entidade,b.mensagem(c.Mensagem),a.dados=a.clear(),a.view.senha2=""}))},a.onClickEditarUsuario=function(b){a.itemBackup=angular.copy(b),a.dados=b,e()},a.onClickDesfazer=function(){var b=a.grade.lista.indexOf(a.dados);a.grade.lista[b]=angular.copy(a.itemBackup),a.itemBackup=a.clear(),a.dados=a.clear(),e()},a.checaSenha=function(){if(a.view.senhaCheck.length>0){var c={usuario_id:a.dados.id,senha1:a.view.senhaCheck};b.post("User/ChecaSenha",c,function(c){1!==parseInt(c)?(b.msgAdvertencia("Senha não confere"),a.view.senhaOK=!1):a.view.senhaOK=!0})}}}]),angular.module("app").controller("orcamentoListarCtrl",["$scope","helper","$routeParams",function(a,b,c){function d(a){b.post("Orcamento/Listar",a,function(a){e(a)})}function e(b){a.view.dados.clearGrid(),a.view.dados=a.toList(b),f(a.view.dados)}function f(b){a.dados.cliente=b[0].cliente,a.dados.descricao=b[0].observacao,a.dados.pedido_situacao=b[0].pedido_situacao,a.dados.pedido_situacao_id=b[0].pedido_situacao_id}a.dados={pedido_id:c.pedido_id,cliente_id:c.cliente_id,cliente:"",descricao:"",pedido_situacao:"",pedido_situacao_id:""},a.view={dados:[]};var g={pedido_id:c.pedido_id,cliente_id:c.cliente_id};d(g),a.onClickAprovar=function(d,f){var g={id:d,situacao_id:5,pedido_id:c.pedido_id,cliente_id:c.cliente_id,estabelecimento_id:f,usuario_aprovou:a.UserCodigo()};b.post("Orcamento/AlterarSituacaoAprovar",g,function(a){b.mensagem(a.Mensagem),e(a.Entidade)})},a.onClickCancelar=function(c,d,e){var f={id:c,situacao_id:4,pedido_id:a.dados.pedido_id,estabelecimento_id:e};b.post("Orcamento/CancelarPelaListagem",f,function(c){b.mensagem(c.Mensagem),a.view.dados[d]=c.Entidade})},a.onClickEnviar=function(c,d,e){var f={id:c,situacao_id:6,pedido_id:a.dados.pedido_id,estabelecimento_id:e};b.post("Orcamento/EnviarPelaListagem",f,function(c){b.mensagem(c.Mensagem),a.view.dados[d]=c.Entidade})}}]),angular.module("app").controller("orcamentoCtrl",["$scope","helper","$routeParams","upload",function(a,b,c,d){function e(b){a.images=angular.copy(b.Lov.images),b.Lov.images=null}function f(){var b={Entidade:a.dados,Lov:a.dadosLov};a.dadosBackup=angular.copy(b)}function g(b){a.dados=b.Entidade,a.dadosLov=b.Lov,a.dadosLov.item=a.toList(b.Lov.item),a.dados.desconto_produto=parseFloat(a.dados.desconto_produto)>0?parseFloat(a.dados.desconto_produto):0,a.dadosLov.servico=a.toList(b.Lov.servico),a.dados.desconto_servico=parseFloat(a.dados.desconto_servico)>0?parseFloat(a.dados.desconto_servico):0,a.dados.situacao_id=a.dados.situacao_id>0?a.dados.situacao_id:"3"}function h(){var c=a.dadosLov.item.find("preco_unitario",null);if(c.length>0)return b.msgAdvertencia('Informe o preço do item "'+c[0].descricao+'"'),!1;var c=a.dadosLov.item.where("preco_unitario","<==",0);return c.length>0?(b.msgAdvertencia('Informe um preço superior a 0 no item "'+c[0].descricao+'"'),!1):""===a.dados.prazo_entrega?(b.msgAdvertencia("Selecione uma prazo de entrega."),!1):a.dados.desconto_produto>=a.dados.valor_total?(b.msgAdvertencia("Desconto não pode ser maior ou igual que valor total."),!1):!0}function i(){return null===a.item.descricao||""===a.item.descricao?(b.msgAdvertencia("Preencha o campo descrição do produto"),!1):null===a.item.quantidade||""===a.item.quantidade||isNaN(a.item.quantidade)?(b.msgAdvertencia("Preencha o campo quantidade do produto"),!1):null===a.item.preco_unitario||""===a.item.preco_unitario?(b.msgAdvertencia("Preencha o campo vlr. unitário do produto"),!1):!0}function j(){return null===a.servico.descricao||""===a.servico.descricao?(b.msgAdvertencia("Preencha o campo descrição do serviço"),!1):null===a.servico.quantidade||""===a.servico.quantidade||isNaN(a.servico.quantidade)?(b.msgAdvertencia("Preencha o campo Quantidade do serviço"),!1):null===a.servico.preco_unitario||""===a.servico.preco_unitario?(b.msgAdvertencia("Preencha o campo vlr. unitário do servico"),!1):!0}a.view={aba:1,salvar:"",editar:!1,isAdm:"",cliente_id:"",editarItem:!1,editarServico:!1,verImagem:!0,tab:1},a.dadosBackup={id:null,situacao_id:null,pedido_id:null,estabelecimento_id:null,prazo_entrega:null,sub_total_produto:null,desconto_produto:null,total_produto:null,sub_total_servico:null,desconto_servico:null,total_servico:null,sub_total:null,desconto:null,valor_total:null},a.dados=a.dadosBackup,a.param=null,a.dadosLov={estabelecimento:[]},a.images=[];var k=function(){return{item_id:null,produto_id:null,descricao:null,orcamento_id:null,quantidade:null,preco_unitario:null}};a.item=k();var l=function(){return{item_id:null,descricao:null,orcamento_id:null,quantidade:null,preco_unitario:null,total:null}};a.servico=l(),c.id>0?(a.dados.id=c.id,a.view.salvar=!0):(a.dados.id=0,a.view.salvar=!1),a.dados.pedido_id=c.pedido_id>0?c.pedido_id:0,a.view.cliente_id=c.cliente_id,b.post("Orcamento/Buscar",a.dados,function(b){g(b),e(b),f(),a.view.isAdm=1===parseInt(a.user.Nivel)}),a.onClickSalvarEhEnviar=function(){if(!h())return!1;var c={dados:a.dados,item:a.dadosLov.item,servico:a.dadosLov.servico,outros:a.dadosLov.pedido.servico};f(),a.dados.id>0?b.post("Orcamento/Editar",c,function(c){a.view.salvar=!0,a.view.editar=!1,b.mensagem(c.Mensagem)}):b.post("Orcamento/Cadastrar",c,function(c){a.view.salvar=!0,a.view.editar=!1,a.dados.id=c.Entidade.id,a.dados.estabelecimento_id=c.Entidade.estabelecimento_id,b.mensagem(c.Mensagem)})},a.onclickAbrirUpload=function(){var b={server:"Orcamento/Upload",limiteArquivos:10,formData:a.dados.id};d.open(b,function(b){a.images.push(b)})},a.onClickDesfazer=function(){a.view.salvar=!0,a.view.editar=!1,g(angular.copy(a.dadosBackup))},a.onClickEnviar=function(){a.dados.situacao_id="6",b.post("Orcamento/AlterarSituacao",a.dados,function(a){g(a),b.mensagem(a.Mensagem)})},a.onClickCancelar=function(){a.dados.situacao_id="4",b.post("Orcamento/Cancelar",a.dados,function(a){g(a),b.mensagem(a.Mensagem)})},a.onClickItemAdicionar=function(){i()&&(a.dadosLov.item.push(angular.copy(a.item)),a.item=k())},a.onClickItemRemover=function(b){a.dadosLov.item.splice(b,1)},a.onClickEditarItem=function(b){a.view.editarItem=!0,a.itemBackup=angular.copy(a.dadosLov.item[b]),a.item=a.dadosLov.item[b]},a.onClickItemSalvar=function(){i()&&(a.view.editarItem=!1,a.itemBackup={},a.item=k())},a.onClickItemCancelar=function(){a.view.editarItem=!1;var b=a.dadosLov.item.indexOf(a.item);a.dadosLov.item[b]=angular.copy(a.itemBackup),a.itemBackup={},a.item=k()},a.onClickServicoAdicionar=function(){j()&&(a.dadosLov.servico.push(angular.copy(a.servico)),a.servico=l())},a.onClickServicoRemover=function(b){a.dadosLov.servico.splice(b,1)},a.onClickEditarServico=function(b){a.view.editarServico=!0,a.servicoBackup=angular.copy(a.dadosLov.servico[b]),a.servico=a.dadosLov.servico[b]},a.onClickServicoSalvar=function(){j()&&(a.view.editarServico=!1,a.servicoBackup={},a.servico=l())},a.onClickItemCancelar=function(){a.view.editarServico=!1;var b=a.dadosLov.servico.indexOf(a.servico);a.dadosLov.servico[b]=angular.copy(a.servicoBackup),a.servicoBackup={},a.servico=l()},a.onClikAtualizarImagem=function(){a.images=[],b.post("Orcamento/BuscarImagem",{id:a.dados.id},function(b){a.images=b})},a.onClickListarProdutos=function(){a.abrirModal("view-partial/produto-listar-modal.html","produtoListarModalCtrl","lg",a)},a.$on("onClickRemoveImage",function(c,d){a.confirm("Deseja excluir a Imagem?",function(){b.post("Orcamento/ExcluirImagem",{grupo:d,id:a.dados.id},function(b){a.images=b})})}),a.$on("onClickEditImage",function(b,c){var d={dados:{id:a.dados.id,nome:c.nome,texto:c.texto},scope:a};a.abrirModal("view-partial/editar-imagem.html","editarImagemCtrl",null,d)})}]),angular.module("app").controller("pedidoListarCtrl",["$scope","helper","$routeParams",function(a,b,c){function d(c,d){var e=1===d?"Pedido/BuscaAvancada":"Pedido/Listar";b.post(e,c,function(b){a.view.dados.clearGrid(),a.view.dados=a.toList(b)})}a.view={pesquisa:null,filtroUnico:null,placeholder:"Pesquisar por: N° da Solicitação - Descricão - Nome Fantasia - Categoria - Situação - Data Criação - Placa",dados:[],buscaColor1:"red"},a.dadosLov={situacao:"",categoria:""},a.dados=null,b.get("Pedido/CarregarLovListar",null,function(b){a.dadosLov.situacao=b.situacao,a.dadosLov.categoria=b.categoria}),void 0!==c.id&&(a.view.pesquisa={pedido_id:c.id}),a.promessa(function(){a.UserNivel().In(1)||d(a.view.pesquisa)}),a.onKeyPressListar=function(b){13!==b.which&&13!==b.keyCode||d(a.view.filtroUnico)},a.onClickListar=function(){d(a.view.filtroUnico,0)},a.onClickListarAvancada=function(){d(a.dados,1)},a.onClickEnviar=function(c,d){var e={id:c,situacao_id:3};b.post("Pedido/AlterarSituacao",e,function(c){b.mensagem(c.Mensagem),a.view.dados[d]=c.Entidade})},a.onClickCancelar=function(c,d){var e={id:c,situacao_id:4};b.post("Pedido/AlterarSituacao",e,function(c){b.mensagem(c.Mensagem),a.view.dados[d]=c.Entidade})}}]),angular.module("app").controller("pedidoCtrl",["$scope","helper","$routeParams",function(a,b,c){function d(){a.view.dataHora=new Date}function e(){return null===a.item.descricao||""===a.item.descricao?(b.msgAdvertencia("Preencha o campo descrição"),!1):null===a.item.quantidade||""===a.item.quantidade?(b.msgAdvertencia("Preencha o campo Quantidade"),!1):!0}function f(){a.backup.dados=angular.copy(a.dados),a.backup.dadosLov=angular.copy(a.dadosLov)}function g(b){a.dados=b.Entidade,a.dadosLov=b.Lov,a.dadosLov.item=a.toList(b.Lov.item),a.dados.situacao_id=a.dados.situacao_id>0?a.dados.situacao_id:"10","10"!==a.dados.situacao_id&&(a.view.salvar=!0,a.view.editar=!1,a.view.enviar=!1,"4"===a.dados.situacao_id&&(a.view.cancelar=!1))}a.view={aba:1,editarItem:!1,salvar:!0,editar:!0,enviar:!0,cancelar:!0,isAdm:"",existeVeiculo:!1,dataHora:null,tipo:[{id:"2",descricao:"Produto ou/e Serviço"},{id:"1",descricao:"Serviços"}]},a.dados={id:null,categoria_id:null,cliente_id:null,data_criacao:"",observacao:"",marca_modelo:"",placa:"",ano_fabricacao:"",ano_modelo:"",chassi:"",renavam:"",servico:"",usuario_criou:"",km:null,veiculo_id:null},a.dadosLov={cliente:[]},a.backup={},a.itemBackup={id:"",descricao:"",quantidade:"",sugestao:1,produto_id:null},a.item={id:"",descricao:"",quantidade:"",sugestao:1,produto_id:null};var h=function(){return angular.copy({id:"",descricao:"",quantidade:"",sugestao:1,produto_id:null})};c.id>0?(a.view.salvar=!0,a.dados.id=c.id):(a.view.salvar=!1,a.dados.id=0),b.get("Pedido/Buscar",a.dados.id,function(b){g(b),a.dados.data_criacao=d(),a.view.isAdm=1===parseInt(a.user.Nivel),f()}),a.onBuscarVeiculo=function(){a.dados.placa||(a.dados.placa=""),b.get("Veiculo/BuscarPorPlaca",a.dados.placa,function(b){a.view.existeVeiculo=!1,a.dados.marca_modelo=b.marca_modelo,a.dados.ano_fabricacao=b.ano_fabricacao,a.dados.ano_modelo=b.ano_modelo,a.dados.chassi=b.chassi,a.dados.renavam=b.renavam,a.dados.veiculo_id=b.id,a.dados.veiculo_id>0&&(a.view.existeVeiculo=!0)})},a.onClickItemAdicionar=function(){e()&&(a.dadosLov.item.push(angular.copy(a.item)),a.item=h())},a.onClickItemRemover=function(b){a.dadosLov.item.splice(b,1)},a.onClickEditarItem=function(b){a.view.editarItem=!0,a.itemBackup=angular.copy(a.dadosLov.item[b]),a.item=a.dadosLov.item[b]},a.onClickItemSalvar=function(){e()&&(a.view.editarItem=!1,a.itemBackup={},a.item=h())},a.onClickItemCancelar=function(){a.view.editarItem=!1;var b=a.dadosLov.item.indexOf(a.item);a.dadosLov.item[b]=angular.copy(a.itemBackup),a.itemBackup={},a.item=h()},a.onClickSalvar=function(){if(a.view.editarItem===!0)return void b.msgAdvertencia("Salve ou Cancele as alterações dos item(s)");a.dados.usuario_criou=a.UserCodigo();var c={dados:a.dados,item:a.dadosLov.item};a.dados.id>0?b.post("Pedido/Editar",c,function(c){a.view.salvar=!0,b.mensagem(c.Mensagem),f()}):b.post("Pedido/Cadastrar",c,function(c){a.view.salvar=!0,a.dados.id=c.Entidade.id,a.dados.cliente_id=c.Entidade.cliente_id,b.mensagem(c.Mensagem),f()})},a.onClickEnviar=function(){a.dados.situacao_id="3",b.post("Pedido/MudarSituacaoPedido",a.dados,function(c){a.view.salvar=!0,a.view.editar=!1,a.view.enviar=!1,a.dados=c.Entidade,a.dadosLov.situacao=c.Lov.situacao,b.mensagem(c.Mensagem)})},a.onClickCancelar=function(){a.dados.situacao_id="4",b.post("Pedido/Cancelar",a.dados,function(c){a.view.cancelar=!1,a.dados=c.Entidade,a.dadosLov.situacao=c.Lov.situacao,b.mensagem(c.Mensagem)})},a.onClickDesfazer=function(){a.view.salvar=!0,a.view.editar=!0,a.dados=angular.copy(a.backup.dados),a.dadosLov=angular.copy(a.backup.dadosLov)},a.onClickListarProdutos=function(){a.abrirModal("view-partial/produto-listar-modal.html","produtoListarModalCtrl","lg",a)}}]),angular.module("app").controller("produtoListarModalCtrl",["$scope","helper","$modalInstance","param",function(a,b,c,d){function e(c){b.post("Produto/Listar",c,function(b){a.view.dados.clearGrid(),a.view.dados=a.toList(b)})}a.view={pesquisa:null,filtroUnico:null,placeholder:"Pesquisar por: Codigo Interno - Código Inventário - Nome Produto - Modelo - Categoria - Grupo - Sub-Grupo",dados:[]},a.promessa(function(){!a.UserNivel().In(1)}),a.onKeyPressListar=function(b){13!==b.which&&13!==b.keyCode||e(a.view.filtroUnico)},a.onClickListar=function(){e(a.view.filtroUnico)},a.onClickFecharModal=function(){c.dismiss("cancel")},a.onClickAssociar=function(a,b,e){d.item.produto_id=angular.copy(a),d.item.descricao=angular.copy(e),c.dismiss("cancel")}}]),angular.module("app").controller("produtoListarCtrl",["$scope","helper",function(a,b){function c(c){b.post("Produto/Listar",c,function(b){a.view.dados.clearGrid(),a.view.dados=a.toList(b)})}a.view={pesquisa:null,filtroUnico:null,placeholder:"Pesquisar por: Codigo Interno - Código Inventário - Nome Produto - Modelo - Categoria - Grupo - Sub-Grupo",dados:[]},a.promessa(function(){a.UserNivel().In(1)||c(a.view.filtroUnico)}),a.onKeyPressListar=function(b){13!==b.which&&13!==b.keyCode||c(a.view.filtroUnico)},a.onClickListar=function(){c(a.view.filtroUnico)}}]),angular.module("app").controller("produtoCtrl",["$scope","helper","$routeParams",function(a,b,c){function d(){return{id:null,categoria_id:null,grupo_id:null,sub_grupo_id:null,codigo:null,descricao:null,modelo:null,produto_preco:{estabelecimento_id:null,produto_id:null,preco_unitario:null,data_fabricacao:null,estoque:null}}}function e(c){b.post("Produto/Buscar",c,function(b){a.lov=b.Lov,a.dados=b.Entidade,a.onChangeCarregaGrupo(a.dados.categoria_id),a.onChangeCarregaSubGrupo(a.dados.grupo_id)})}function f(c){b.post("Produto/Cadastrar",a.dados,c)}function g(c){b.post("Produto/Editar",a.dados,c)}a.view={codigo:0,bloquearCampos:!1},a.lov={categoria:[],grupo:[],sub_grupo:[],estabelecimento:null};var h={produto_id:c.produto_id>0?c.produto_id:0,estabelecimento_id:c.estabelecimento_id>0?c.estabelecimento_id:0};a.dados=d(),e(h),a.onClickSalvar=function(){a.dados.id>0?g(function(c){b.mensagem(c.Mensagem),a.dados=d(),a.view.bloquearCampos=!1}):f(function(c){a.dados.id=c.Entidade.id,b.mensagem(c.Mensagem),a.dados=d(),a.view.bloquearCampos=!1})},a.onClickDesfazerSalvar=function(){a.dados=d(),a.view.bloquearCampos=!1},a.onChangeObterProduto=function(){a.view.codigo>0&&a.view.codigo!==a.dados.id&&(h.produto_id=a.view.codigo,e(h),a.view.bloquearCampos=!0)},a.onChangeCarregaGrupo=function(c){c>0&&b.get("Grupo/BuscarPorCategoria",c,function(b){a.lov.grupo=b})},a.onChangeCarregaSubGrupo=function(c){c>0&&b.get("SubGrupo/BuscarPorGrupo",c,function(b){a.lov.sub_grupo=b})}}]),angular.module("app").controller("recuperarSenhaCtrl",["$scope","helper",function(a,b){a.dados={email:""},a.RecuperarSenha=function(){if(a.dados.email.isNullOrEmpty()){var c=[{Tipo:3,Mensagem:"Preencha o campo email"}];return void b.mensagem(c)}b.post("User/RecuperarSenha",a.dados,function(a){b.mensagem(a),b.redirecionar("/",4)})}}]),angular.module("app").controller("relatorioCtrl",["$scope","helper",function(a,b){a.dados={filtro:null,valor:null,situacao:null,data1:null,data2:null},a.view={descricao:null,resultado:[],dadosLov:null},a.pesquisa={filtro:[{id:"e.nome_fantasia",descricao:"Estabelecimento"},{id:"t.nome_fantasia",descricao:"Cliente"},{id:"p.data_aprovacao",descricao:"Data Aprovação"},{id:"p.data_criacao",descricao:"Data Criação"},{id:"p.renavam",descricao:"Renavam"},{id:"p.placa",descricao:"Placa"},{id:"p.chassi",descricao:"Chassi"},{id:"periodo_aprovacao",descricao:"Período Aprovação"}]},b.get("Relatorio/Buscar",null,function(b){a.view.dadosLov=b.Lov}),a.onClickFiltrar=function(){b.post("Relatorio/Filtrar",a.dados,function(b){a.view.resultado.clearGrid(),a.view.resultado=a.toList(b.Entidade)})}}]),angular.module("app").controller("subGrupoCtrl",["$scope","helper",function(a,b){function c(c){b.post("SubGrupo/Cadastrar",a.dados,c)}function d(c){b.post("SubGrupo/Editar",a.dados,c)}a.view={editar:!1},a.dados={id:null,descricao:null,categoria_id:null,grupo_id:null},a.backup={id:null,descricao:null,categoria_id:null,grupo_id:null},a.lov={categoria:[],grupo:[]},a.grade={lista:[]},b.get("SubGrupo/Listar",a.dados.id,function(b){a.grade.lista=b.Entidade,a.lov=b.Lov}),a.onClickSalvar=function(){a.dados.id>0?d(function(c){a.grade.lista=c.Entidade,b.mensagem(c.Mensagem),a.view.editar=!1,a.view.editar=!1,a.dados={}}):c(function(c){a.grade.lista=c.Entidade,b.mensagem(c.Mensagem),a.dados={}})},a.onChangeCarregaGrupo=function(c){c>0&&b.get("Grupo/BuscarPorCategoria",c,function(b){a.lov.grupo=b})},a.onClickEditarItem=function(b){a.backup.id=angular.copy(b.id),a.backup.descricao=angular.copy(b.descricao),a.backup.categoria_id=angular.copy(b.categoria_id),a.backup.grupo_id=angular.copy(b.grupo_id),a.dados.id=b.id,a.dados.descricao=b.descricao,a.dados.categoria_id=b.categoria_id,a.dados.grupo_id=b.grupo_id,a.onChangeCarregaGrupo(b.categoria_id),a.view.editar=!0},a.onClickDesfazerSalvar=function(){a.view.editar=!1;var b=a.grade.lista.indexOf(a.dados);a.grade.lista[b]=angular.copy(a.backup),a.backup={},a.dados={}}}]),angular.module("app").controller("usuarioCtrl",["$scope","helper","$modalInstance","param",function(a,b,c,d){function e(){d.funcao&&d.funcao(),a.onClickFecharModal()}function f(){b.post("User/Cadastrar",h(),function(a){b.mensagem(a),e()})}function g(){return a.view.alterarSenha===!0&&a.dados.senha1===a.dados.senha3?void b.msgAdvertencia("Senha atual igual a senha nova. Digite senhas diferentes."):void b.post("User/Editar",i(),function(a){b.mensagem(a),e()})}function h(){return{Entidade:{nome:a.dados.nome,email:a.dados.email,senha:a.dados.senha2,nivel:a.dados.nivel,token:null},TabelaParaVincular:{usuario_id:a.dados.usuario_id,tabela_id:a.dados.tabela_id,tabela_nome:a.dados.tabela_nome,ativo:1}}}function i(){return{id:a.dados.usuario_id,nome:a.dados.nome,email:a.dados.email,senha:a.dados.senha2,nivel:a.dados.nivel,token:null}}a.view={titulo:"Cadastrar Usuário",email:"Entre com seu email",senha1:"Entre com sua senha",senha2:"Repita sua senha",senha3:"Repita a Nova Senha",alterarSenha:!1,senhaChecadas:!1},a.dados={usuario_id:d.usuario_id,tabela_id:d.tabela_id,tabela_nome:d.tabela_nome,nome:void 0===d.nome?"":d.nome,email:void 0===d.email?"":d.email,nivel:d.nivel,senha1:"",senha2:"",senha3:"",editarEmailEhSenha:void 0!==d.editarEmailEhSenha?d.editarEmailEhSenha:!0},a.dados.usuario_id>0&&(a.view.titulo="Editar Usuário",a.view.senha1="Digite sua senha antiga",a.view.senha2="Digite sua nova senha"),a.salvar=function(){if(a.dados.senha2!==a.dados.senha3){var c=[{Tipo:3,Mensagem:"senhas não confererem"}];return void b.mensagem(c)}a.dados.usuario_id>0?g():f()},a.checaSenha=function(){null!==a.dados.senha1&&a.dados.senha1.length>0&&b.post("User/ChecaSenha",a.dados,function(c){1!==parseInt(c)?(b.msgAdvertencia("Senha não confere"),a.dados.senha1=null,a.view.senhaChecadas=!1):a.view.senhaChecadas=!0})},a.keyChecaSenha=function(b){13!==b.which&&13!==b.keyCode||a.checaSenha()},a.onClickFecharModal=function(){c.dismiss("cancel")}}]),angular.module("app").controller("veiculoListarCtrl",["$scope","helper",function(a,b){function c(){b.post("Veiculo/Listar",a.view.filtroUnico,function(b){a.view.dados.clearGrid(),a.view.dados=a.toList(b)})}a.view={filtroUnico:"",placeholder:"Pesquisar por: Código - Placa - Marca/Modelo - Cliente",dados:[]},a.promessa(function(){a.UserNivel().In(1)||c()}),a.onKeyPressListar=function(a){13!==a.which&&13!==a.keyCode||c()},a.onClickListar=function(){c()}}]),angular.module("app").controller("veiculoCtrl",["$scope","helper","$routeParams","serviceModel",function(a,b,c,d){a.view={editar:!1},a.dados=d.veiculo(),a.dadosLov=null,a.dados.id=c.id?c.id:0,b.get("Veiculo/Buscar",a.dados.id,function(b){a.dados=b.Entidade,a.dadosLov=b.Lov}),a.onClickSalvar=function(){a.dados.id>0?b.post("Veiculo/Editar",a.dados,function(c){b.mensagem(c.Mensagem),a.view.editar=!1,a.view.editar=!1}):b.post("Veiculo/Cadastrar",a.dados,function(c){b.mensagem(c.Mensagem),a.dados=d.veiculo()})}}]);